name: A workflow for my Hello World file
on: push
jobs:
  build:
    name: Hello world action
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - uses: ./action-dependency
    - run: sudo apt-get -y install libnetcdf-dev
    - run: wget https://github.com/Unidata/netcdf-cxx4/archive/v4.3.1.tar.gz
    - run: tar -xvzf v4.3.1.tar.gz
    - run: ls
    - run: mkdir netcdfcxxbuild
    - run: h5cc -showconfig
    - run: dpkg -L libhdf5-dev
    - run: export CPPFLAGS="-I/usr/include/hdf5/serial"
    - run: export CFLAGS="-I/usr/include/hdf5/serial"
    - run: mkdir netcdf-cxx4-4.3.1/build && cd netcdf-cxx4-4.3.1/build && cmake -DCMAKE_CPP_FLAGS=-I/usr/include/hdf5/serial -DCMAKE_C_FLAGS=-I/usr/include/hdf5/serial -DCMAKE_INSTALL_PREFIX=$GITHUB_WORKSPACE/netcdfcxxbuild .. && make VERBOSE=1 && ctest && make install
    - run: git clone https://github.com/thrust/thrust.git
    - run: dpkg -L libnetcdf-dev
    - run: export NETCDF_DIR_LIB=$GITHUB_WORKSPACE/netcdfcxxbuild/lib
    - run: export NETCDF_DIR_INC=$GITHUB_WORKSPACE/netcdfcxxbuild/include
    - run: cd build && cmake -DTHRUST_INCLUDE_DIR=$GITHUB_WORKSPACE/thrust -DNETCDF_CXX_INCLUDE_DIR=$NETCDF_DIR_INC -DNETCDF_CXX_LIBRARY=$NETCDF_DIR_LIB -DNETCDF_LIBRARIES=$NETCDF_DIR_LIB -DNETCDF_INCLUDE_DIRS=$NETCDF_DIR_INC  ..
      env:
        MY_NAME: "Tim"

